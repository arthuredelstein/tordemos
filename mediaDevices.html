<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <title>MediaDevices fingerprinting</title>
 </head>
 <body>
   <script>
    const widthGreaterThan = async function (threshold) {
      try {
        await navigator.mediaDevices.getUserMedia(
          { video : { width : { max : threshold },
                      frameRate : { max : 1 }}});
      } catch (e) {
        return (e.constraint === "width");
      }
    };

    const heightGreaterThan = async function (threshold) {
      try {
        await navigator.mediaDevices.getUserMedia(
          { video : { height : { max : threshold },
                      frameRate : { max : 1 }}});
      } catch (e) {
        return (e.constraint === "height");
      }
    };

    const integerBinarySearch = async function integerBinarySearch (answerGreaterThan, [min, max]) {
      if (min === max) {
        return min;
      }
      let middle = Math.floor((min + max) / 2);
      let tooLow = await answerGreaterThan(middle);
      return await integerBinarySearch(answerGreaterThan,
                                       tooLow ? [middle + 1, max] : [min, middle]);
    }

    const getDimensions = async function () {
      let width = await integerBinarySearch(widthGreaterThan, [1, 20000]);
      let height = await integerBinarySearch(heightGreaterThan, [1, 20000]);
      console.log(width, height);
      return { width, height };
    };
   </script>
 </body>
</html>

